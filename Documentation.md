# Полная документация кода проекта

## Оглавление
1. [Архитектура проекта](#архитектура-проекта)
2. [Система безопасности](#система-безопасности)
3. [Структура файлов](#структура-файлов)
4. [Детальное описание компонентов](#детальное-описание-компонентов)

## Архитектура проекта

### Общая структура

```
GUIforDB/
├── web_app.py              # Главный файл Flask приложения
├── app/
│   └── security/           # Модуль безопасности
│       ├── sql_guard.py    # Главная система защиты от SQL injection
│       ├── rule_based.py   # Rule-based проверки
│       ├── ml_guard.py     # ML-модель для обнаружения атак
│       └── decorators.py   # Декораторы безопасности
├── templates/              # HTML шаблоны (Jinja2)
├── init/                   # SQL скрипты инициализации БД
├── docker-compose.yml      # Конфигурация Docker
└── requirements.txt       # Python зависимости
```

### Технологический стек

**Backend:**
- **Flask 3.0.3** - веб-фреймворк
  - Выбор: легковесный, гибкий, хорошая документация
  - Альтернативы: Django (слишком тяжелый), FastAPI (для API)
  
- **PostgreSQL** - реляционная БД
  - Выбор: надежность, ACID, расширяемость, JSON поддержка
  - Используется через psycopg2 драйвер

**Безопасность:**
- **bcrypt** - хеширование паролей
  - Адаптивный алгоритм, защита от brute-force
  
- **Многослойная guard-система** - защита от SQL injection
  - Whitelist, Rule-based, ML-based проверки

**Дополнительно:**
- **gspread** - интеграция с Google Sheets
- **scikit-learn** - ML модель для обнаружения SQL injection

## Система безопасности

### Многослойная защита от SQL Injection

```
┌─────────────────────────────────────┐
│   Пользовательский SQL запрос       │
└──────────────┬──────────────────────┘
               │
               ▼
┌─────────────────────────────────────┐
│   1. WHITELIST проверка              │  ← Быстрая проверка известных безопасных паттернов
│   (is_whitelisted)                  │
└──────────────┬──────────────────────┘
               │ (не в whitelist)
               ▼
┌─────────────────────────────────────┐
│   2. Структурная валидация           │  ← Проверка длины, символов, структуры
│   (validate_sql_structure)           │
└──────────────┬──────────────────────┘
               │ (прошла)
               ▼
┌─────────────────────────────────────┐
│   3. RULE-BASED проверка             │  ← Проверка опасных паттернов (regex)
│   (rule_based_check)                 │
└──────────────┬──────────────────────┘
               │ (прошла)
               ▼
┌─────────────────────────────────────┐
│   4. ML-BASED проверка               │  ← Машинное обучение для сложных атак
│   (MLSQLGuard.check)                 │
└──────────────┬──────────────────────┘
               │
               ▼
        [РАЗРЕШЕН / ЗАБЛОКИРОВАН]
```

### Уровни защиты

1. **Whitelist** - быстрый путь для известных безопасных запросов
2. **Structure Validation** - проверка структуры запроса
3. **Rule-based** - проверка известных паттернов атак
4. **ML-based** - обнаружение новых/сложных атак через ML

## Детальное описание компонентов

### web_app.py

Главный файл приложения, содержит:
- Конфигурацию Flask
- Систему ролей и прав доступа
- Функции безопасности
- Все HTTP эндпоинты

### app/security/sql_guard.py

Главная система защиты от SQL injection.

**Функции:**
- `validate_sql()` - главная функция проверки
- `is_whitelisted()` - проверка whitelist
- `validate_sql_structure()` - проверка структуры

### app/security/rule_based.py

Rule-based проверки на основе регулярных выражений.

**Паттерны:**
- UNION-based injection
- Boolean-based injection
- Time-based injection
- Stacked queries
- И другие

### app/security/ml_guard.py

ML-модель для обнаружения SQL injection атак.

**Особенности:**
- Singleton паттерн (одна модель на приложение)
- Адаптивный порог (строже для подозрительных запросов)
- Thread-safe (защита от race conditions)

## Принципы проектирования

### 1. Defense in Depth (Защита в глубину)
Множественные уровни защиты на случай, если один слой пропустит атаку.

### 2. Fail-Safe Defaults
По умолчанию блокируем, разрешаем только явно безопасное.

### 3. Principle of Least Privilege
Пользователи получают минимально необходимые права.

### 4. Whitelist over Blacklist
Разрешаем только известное безопасное, вместо блокировки известного опасного.

